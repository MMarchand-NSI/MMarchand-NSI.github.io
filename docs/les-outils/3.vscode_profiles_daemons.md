# VSCode : Profils, Daemons et Gestion de la RAM

## üéØ Le Probl√®me

**Situation :** Tu installes 20 extensions dans VSCode (Python, Rust, Elm, C++, etc.)  
**R√©sultat :** VSCode bouffe 4 GB de RAM et rame üêå

**Pourquoi ?** Les **daemons** lanc√©s par chaque extension tournent en permanence !

---

## 1. C'est Quoi un Daemon ?

### D√©finition Simple

**Daemon** (ou d√©mon) = **Programme qui tourne en arri√®re-plan en permanence**

**Caract√©ristiques :**
- Lance au d√©marrage
- Tourne sans interface visible
- Attend des requ√™tes
- Consomme de la RAM m√™me si tu ne l'utilises pas

### Analogie

**Un daemon, c'est comme un serveur dans un restaurant :**
- Il est toujours l√†, m√™me s'il n'y a pas de clients
- Il attend qu'on lui demande quelque chose
- Il reste debout toute la journ√©e (= consomme de la RAM)

### Exemples de Daemons Syst√®me

| Daemon | R√¥le |
|--------|------|
| `sshd` | Serveur SSH (connexions distantes) |
| `httpd` | Serveur web Apache |
| `systemd` | Gestion des services Linux |
| `Docker daemon` | Gestion des conteneurs |

---

## 2. Les Daemons dans VSCode

### Pourquoi les Extensions Lancent des Daemons ?

**Les extensions de langages ont besoin de :**
1. **Analyser ton code en temps r√©el**
2. **Fournir l'autocompl√©tion**
3. **D√©tecter les erreurs**
4. **Formater le code**
5. **Naviguer dans les d√©finitions**

**Pour √™tre r√©actives, elles lancent un daemon qui :**
- Lit ton code
- L'analyse en permanence
- Garde le r√©sultat en m√©moire
- R√©pond instantan√©ment √† tes demandes

### Exemples de Daemons d'Extensions

| Extension | Daemon | RAM |
|-----------|--------|-----|
| **Python** | Pylance Language Server | ~200 MB |
| **Rust** | rust-analyzer | ~300 MB |
| **C/C++** | clangd | ~150 MB |
| **Elm** | Elm Language Server | ~100 MB |
| **Java** | Eclipse JDT LS | ~500 MB |
| **TypeScript** | tsserver | ~250 MB |

**Total si tout install√© : 1.5 GB+ de RAM !** üí•

### Visualiser les Daemons

**Dans VSCode :**
1. Ouvre la palette : `Ctrl+Shift+P`
2. Tape : "Developer: Show Running Extensions"
3. Regarde la colonne "Activation Time" et "Memory"

**En ligne de commande :**
```bash
# Linux/Mac
ps aux | grep -E "python|rust-analyzer|clangd|elm"

# Windows
tasklist | findstr "python rust clangd"
```

---

## 3. Pourquoi Cr√©er des Profils par Langage

### Le Probl√®me Sans Profils

```
VSCode avec TOUTES les extensions
‚îú‚îÄ‚îÄ Python extension ‚Üí lance python daemon (200 MB)
‚îú‚îÄ‚îÄ Rust extension ‚Üí lance rust-analyzer (300 MB)
‚îú‚îÄ‚îÄ Elm extension ‚Üí lance elm daemon (100 MB)
‚îú‚îÄ‚îÄ C++ extension ‚Üí lance clangd (150 MB)
‚îî‚îÄ‚îÄ ... 15 autres extensions

Total RAM : 2-4 GB
```

**M√™me si tu codes en Python, les daemons Rust/Elm/C++ tournent quand m√™me !**

### La Solution : Profils

**Un profil = un VSCode avec seulement les extensions n√©cessaires**

```
Profil Python
‚îú‚îÄ‚îÄ Python extension ‚Üí 200 MB
‚îî‚îÄ‚îÄ Extensions g√©n√©rales (Git, etc.)
Total RAM : 400 MB

Profil Rust
‚îú‚îÄ‚îÄ Rust extension ‚Üí 300 MB
‚îî‚îÄ‚îÄ Extensions g√©n√©rales
Total RAM : 500 MB
```

**√âconomie : 1.5-3 GB de RAM par profil !** üí∞

---

## 4. Cr√©er des Profils dans VSCode

### M√©thode Graphique

**√âtape 1 : Ouvrir le menu des profils**
1. Clique sur l'ic√¥ne ‚öôÔ∏è (engrenage) en bas √† gauche
2. S√©lectionne "Profiles"
3. Clique sur "Create Profile"

**√âtape 2 : Configurer le profil**
```
Nom : Python Development
Copier depuis : Default Profile (ou None)
```

**√âtape 3 : Activer le profil**
- Le profil s'active automatiquement apr√®s cr√©ation
- Tu peux switcher avec : ‚öôÔ∏è ‚Üí Profiles ‚Üí S√©lectionne un profil

**√âtape 4 : Installer uniquement les extensions n√©cessaires**
```
Pour Python :
‚úÖ Python
‚úÖ Pylance
‚úÖ Python Debugger
‚úÖ Git (g√©n√©ral)
‚úÖ GitLens (g√©n√©ral)
‚ùå Rust-analyzer (pas besoin)
‚ùå Elm (pas besoin)
```

### M√©thode Ligne de Commande

```bash
# Lancer VSCode avec un profil sp√©cifique
code --profile "Python Development"

# Cr√©er un profil vide
code --profile "Rust Development" --extensions-dir ~/.vscode-rust/extensions
```

### Structure Recommand√©e

```
Profils √† cr√©er :
‚îú‚îÄ‚îÄ Default (minimal, sans language servers)
‚îú‚îÄ‚îÄ Python Development
‚îú‚îÄ‚îÄ Rust Development
‚îú‚îÄ‚îÄ Web Development (HTML/CSS/JS)
‚îú‚îÄ‚îÄ Elm Development
‚îú‚îÄ‚îÄ C/C++ Development
‚îî‚îÄ‚îÄ √âcriture (Markdown, pas de code)
```

---

## 5. Configuration D√©taill√©e par Profil

### Profil Python

**Extensions √† installer :**
```
- Python (ms-python.python)
- Pylance (ms-python.vscode-pylance)
- Python Debugger (ms-python.debugpy)
- Black Formatter (optionnel)
```

**Settings sp√©cifiques :**
```json
{
  "python.languageServer": "Pylance",
  "python.analysis.typeCheckingMode": "basic",
  "[python]": {
    "editor.formatOnSave": true,
    "editor.defaultFormatter": "ms-python.black-formatter"
  }
}
```

### Profil Rust

**Extensions √† installer :**
```
- rust-analyzer (rust-lang.rust-analyzer)
- CodeLLDB (debugger)
- crates (gestion des d√©pendances)
```

**Settings sp√©cifiques :**
```json
{
  "rust-analyzer.checkOnSave.command": "clippy",
  "[rust]": {
    "editor.formatOnSave": true,
    "editor.defaultFormatter": "rust-lang.rust-analyzer"
  }
}
```

### Profil Elm

**Extensions √† installer :**
```
- Elm (Elmtooling.elm-ls-vscode)
- Elm Format
```

**Settings sp√©cifiques :**
```json
{
  "[elm]": {
    "editor.formatOnSave": true
  }
}
```

### Profil Minimal (√âcriture)

**Extensions √† installer :**
```
- Markdown All in One
- Spell Checker
- Git
```

**Pas de language server = ~50 MB RAM seulement !**

---

## 6. Comment Fonctionnent les Language Servers

### Architecture Client-Serveur

```
VSCode (Client)
    ‚Üì demande d'autocompl√©tion
Language Server (Daemon)
    ‚Üì analyse le code
    ‚Üì retourne les suggestions
VSCode affiche les suggestions
```

### Le Protocol LSP (Language Server Protocol)

**Invent√© par Microsoft pour VSCode**

**Avant LSP :**
```
Chaque √©diteur √ó Chaque langage = N √ó M impl√©mentations
Vim + Python, Vim + Rust, Emacs + Python, Emacs + Rust...
```

**Avec LSP :**
```
1 Language Server par langage
√ó 
N √©diteurs qui parlent LSP
= N + M impl√©mentations seulement !
```

**Liste de Language Servers :**
| Langage | Language Server |
|---------|-----------------|
| Python | Pylance, Pyright |
| Rust | rust-analyzer |
| C/C++ | clangd, ccls |
| JavaScript/TypeScript | tsserver |
| Elm | elm-language-server |
| Go | gopls |
| Java | Eclipse JDT LS |

---

## 7. Cr√©er Ton Propre Daemon (Exemple Avanc√©)

### Pourquoi Cr√©er un Daemon ?

**Cas d'usage :**
- Surveiller des fichiers
- Compiler automatiquement
- Lancer des tests en continu
- Analyser le code custom

### Exemple Simple en Python

```python
# mon_daemon.py
import time
import os
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler

class MonDaemon(FileSystemEventHandler):
    def on_modified(self, event):
        if event.src_path.endswith('.elm'):
            print(f"Fichier modifi√© : {event.src_path}")
            os.system(f"elm make {event.src_path}")

if __name__ == "__main__":
    print("üîÑ Daemon Elm lanc√©...")
    
    observer = Observer()
    observer.schedule(MonDaemon(), path="./src", recursive=True)
    observer.start()
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        observer.stop()
    
    observer.join()
```

**Lancer le daemon :**
```bash
python mon_daemon.py &  # Le & lance en arri√®re-plan
```

### Int√©gration dans VSCode

**Cr√©er une t√¢che VSCode (`.vscode/tasks.json`) :**
```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start Elm Daemon",
      "type": "shell",
      "command": "python",
      "args": ["${workspaceFolder}/mon_daemon.py"],
      "isBackground": true,
      "problemMatcher": []
    }
  ]
}
```

**Lancer avec :** `Ctrl+Shift+P` ‚Üí "Tasks: Run Task" ‚Üí "Start Elm Daemon"

---

## 8. G√©rer les Daemons qui Consomment Trop

### Diagnostiquer

**1. VSCode Task Manager**
```
Ctrl+Shift+P ‚Üí "Developer: Open Process Explorer"
```

Montre tous les processus avec leur RAM.

**2. Ligne de commande**
```bash
# Linux/Mac : Voir les processus VSCode
ps aux | grep "vscode\|electron" | grep -v grep

# Trier par RAM
ps aux --sort=-%mem | head -20

# Windows : Task Manager
tasklist | findstr "Code.exe"
```

### D√©sactiver Temporairement des Extensions

**Sans changer de profil :**
1. `Ctrl+Shift+X` ‚Üí Extensions
2. Clique sur l'engrenage de l'extension
3. "Disable (Workspace)" ‚Üí d√©sactive uniquement pour ce projet

### Limiter la RAM des Language Servers

**Exemple pour Pylance :**
```json
{
  "python.analysis.memory.keepLibraryAst": false,
  "python.analysis.memory.keepLibraryLocalVariables": false
}
```

**Exemple pour rust-analyzer :**
```json
{
  "rust-analyzer.server.extraEnv": {
    "RA_LOG": "error"  // Moins de logs = moins de RAM
  }
}
```

---

## 9. Bonnes Pratiques

### ‚úÖ √Ä Faire

1. **Un profil par langage principal**
   - Python, Rust, Web, etc.

2. **Profil minimal pour l'√©criture**
   - Markdown, notes, docs
   - Pas de language server = rapide

3. **D√©sactiver les extensions inutilis√©es**
   - Pas besoin de Rust si tu codes en Python

4. **Fermer VSCode entre les projets**
   - Lib√®re la RAM des daemons

5. **Surveiller la RAM r√©guli√®rement**
   - Process Explorer de VSCode

### ‚ùå √Ä √âviter

1. **Installer toutes les extensions "au cas o√π"**
   - Elles tournent m√™me inutilis√©es

2. **Laisser VSCode ouvert H24**
   - Les daemons accumulent la RAM

3. **Ouvrir plusieurs VSCode avec le m√™me profil**
   - Plusieurs instances du m√™me daemon

4. **Ignorer les warnings de RAM**
   - VSCode te pr√©vient si √ßa rame

---

## 10. Tableau R√©capitulatif

### Impact sur la RAM

| Sc√©nario | RAM Utilis√©e | R√©activit√© |
|----------|--------------|------------|
| Toutes extensions | 3-5 GB | Lent üêå |
| Profil Python seul | 400-600 MB | Rapide ‚ö° |
| Profil minimal | 50-150 MB | Tr√®s rapide üöÄ |

### Temps de D√©marrage

| Configuration | D√©marrage |
|---------------|-----------|
| Sans profils (20 extensions) | 10-15s |
| Avec profil (5 extensions) | 2-3s |
| Profil minimal | <1s |

---

## üéØ R√©sum√©

### Daemon
- Programme en arri√®re-plan permanent
- Consomme de la RAM m√™me inactif
- N√©cessaire pour √™tre r√©actif

### Probl√®me
- Chaque extension de langage lance un daemon
- 20 extensions = 2-4 GB de RAM gaspill√©s

### Solution : Profils
- 1 profil = 1 VSCode avec extensions sp√©cifiques
- √âconomie de 1.5-3 GB par profil
- D√©marrage plus rapide

### Action
1. Cr√©e un profil par langage
2. N'installe que les extensions n√©cessaires
3. Change de profil selon ton travail

**Tu passes de 4 GB √† 500 MB de RAM utilis√©e !** üí™

---

## üìö Ressources

**Documentation VSCode :**
- [Profiles Guide](https://code.visualstudio.com/docs/editor/profiles)
- [Extension API](https://code.visualstudio.com/api)

**Language Server Protocol :**
- [Specification officielle](https://microsoft.github.io/language-server-protocol/)

**Optimisation :**
- [Performance Issues Guide](https://github.com/microsoft/vscode/wiki/Performance-Issues)

---

**Pro Tip Final :** Active le profil AVANT d'ouvrir un projet. Sinon les daemons se lancent quand m√™me ! üéØ
